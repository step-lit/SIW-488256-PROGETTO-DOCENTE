<!DOCTYPE html>

<html lang="it" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

	<head>
	    <meta charset="utf-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1">
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
	    <link rel="stylesheet" type="text/css" th:href="@{/css/visualizza-autore.css}"/>
	    <title>Dettagli autore – Libreria Universo</title>
	</head>

	<body>
    
		<header class="site-header">
			<nav class="navbar-container">
				<div class="nav-left"></div>
								
				<div class="nav-center">
					<div class="logo-container">
						<a th:href="@{/}">
							<img th:src="@{/images/logo.png}" alt="Logo libreria" id="nav-logo">
						</a>
					</div>
					
					<div class="nav-links">
						<a th:href="@{/index}">Home</a>
						<a th:href="@{/libri}">Libri</a>
						<a th:href="@{/autori}">Autori</a>
						<a th:href="@{/contatti}">Contatti</a>
					</div>
				</div>
								
				<div class="nav-right">
					
					<div class="user-actions">	
						<div th:if="${userDetails}" class="user-greeting">
							<p th:text="'Ciao, ' + ${userDetails.username} + '!'">Ciao, Utente!</p>
						</div>
								
						<form th:if="${userDetails}" th:action="@{/logout}" method="POST" style="display: inline;">
							<button type="submit" class="btn-custom btn-logout">Logout</button>
						</form>
												
						<form th:unless="${userDetails}" th:action="@{/login}" method="GET" style="display: inline;">
							<button type="submit" class="btn-custom btn-login">Login</button>
						</form>
												
						<form th:unless="${userDetails}" th:action="@{/register}" method="GET" style="display: inline;">
							<button type="submit" class="btn-custom btn-register">Registrati</button>
						</form>
					</div>
					
				</div>
			</nav>
		</header>
    
	    <main>
	        <section class="visualizza-autore-container" th:if="${autore}">
				
				<div class="alert alert-primary" role="alert" th:text="${successModificaAutore}" th:if="${successModificaAutore}"></div>
				
	            <h2>Dettagli dell'autore</h2>
	
	            <div class="autore-details">
	                <div class="autore-foto">
	                    <img th:src="${autore.getBase64Image()}" alt="Foto dell'autore">
	                </div>
	                
	                <div class="autore-info">
	                    <h1 th:text="${autore.name} + ' ' + ${autore.surname}">Nome Cognome</h1>
	
	                    <div class="info-item">
	                        <strong>Data di nascita:</strong>
	                        <span th:text="${#temporals.format(autore.dateOfBirth, 'dd/MM/yyyy')}">Data di Nascita</span>
	                    </div>
	
	                    <div class="info-item">
	                        <strong>Data di morte:</strong>
	                        <span th:text="${autore.dateOfDeath != null ? #temporals.format(autore.dateOfDeath, 'dd/MM/yyyy') : '-'}">Data di Morte</span>
	                    </div>
	
	                    <div class="info-item">
	                        <strong>Nazionalità:</strong>
	                        <span th:text="${autore.nationality != '' ? autore.nationality : '-'}">Nazionalità</span>
	                    </div>
	
	                    <div class="autore-edit" sec:authorize="hasAuthority('ADMIN_ROLE')">
	                        <a th:href="@{/autori/modifica-autore/{id}(id=${autore.id})}">Modifica autore</a>
	                        <a th:href="@{/autori/cancella-autore/{id}(id=${autore.id})}" onclick="return confirmCancella(this.href);">Cancella autore</a>
	                    </div>
	                </div>
	            </div>
			</section>
	        
			<section class="libri-autore-section" th:if="${autore}">
	        	<h2>Libri di questo autore:</h2>
					
	            <div th:if="${#lists.isEmpty(autore.libri)}">
	            	<p class="no-libri">Non ci sono ancora libri associati per questo autore.</p>
	            </div>
				
	            <div class="libri-container" th:unless="${#lists.isEmpty(autore.libri)}">
	            	<div class="libro-item" th:each="libro : ${autore.libri}">
	                	<a th:href="@{/libri/visualizza-libro/{id}(id=${libro.id})}">
	                    	<img th:src="${libro.getCoverImage()}" alt="Copertina libro" class="libro-cover">
	                    </a>
						
	                    <div class="libro-item-body">
	                    	<h4 class="libro-title" th:text="${libro.title}">Titolo Libro</h4>
	                        <p th:text="'Anno: ' + ${libro.yearOfPublication}">Anno</p>
							<div class="libro-rating">
								<img th:src="@{/images/star.png}" alt="Stella" class="star-icon">
								<span class="rating-avg" th:text="${#numbers.formatDecimal(libro.getAverageVote(), 1, 1)}">Recensioni:</span>
								<span class="rating-count" th:text="'(' + ${libro.getReviewCount()} + ' recensioni)'">(12)</span>
							</div>
	                   	</div>
	                </div>
	            </div>
	
	        </section>
	    </main>
    
		<footer>
			<div class="bottom-nav-links">
				<a th:href="@{/}">Home</a>
				<span>|</span>
				<a th:href="@{/libri}">Libri</a>
				<span>|</span>
				<a th:href="@{/autori}">Autori</a>
				<span>|</span>
				<a th:href="@{/contatti}">Contatti</a>
			</div>
			<p>© Copyright 2025. Tutti i diritti riservati.</p>
		</footer>
		
		<script>
			function confirmCancella(urlCancellazione) {
				if (window.confirm("Sei sicuro di voler effettuare la cancellazione?")) {
					window.location.href = urlCancellazione; 
				}
				return false;
			}
		</script>
    
    	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
		
	</body>
	
</html>